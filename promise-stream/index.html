<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>PromiseStream: 
PromiseStream - ReactPHP</title>

        <meta name="description" content="The missing link between Promise-land and Stream-land for ReactPHP.">

        <link rel="apple-touch-icon" sizes="180x180" href="https://reactphp.org/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://reactphp.org/favicon-32x32.png">
        <link rel="manifest" href="https://reactphp.org/manifest.json">
        <link rel="mask-icon" href="https://reactphp.org/safari-pinned-tab.svg" color="#4f5b93">
        <meta name="apple-mobile-web-app-title" content="ReactPHP">
        <meta name="application-name" content="ReactPHP">
        <meta name="theme-color" content="#f4f3f1">
        <meta name="msapplication-config" content="https://reactphp.org/browserconfig.xml" />

        <meta property="og:image" content="https://reactphp.org/og-image.png">

            <script>window.__assets = '../assets/';</script>

        <link rel="preload" href="../assets/19ca4d35c8f94db0fa14422334dd2ad3.woff" as="font" type="font/woff" crossorigin>
        <link rel="preload" href="../assets/be4ba3dd17008135675e945b630be8f6.woff" as="font" type="font/woff" crossorigin>

        <style>@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:400;font-display:swap;src:local("Source Sans Pro Regular"),local("SourceSansPro-Regular"),url(../assets/19ca4d35c8f94db0fa14422334dd2ad3.woff) format("woff")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:700;font-display:swap;src:local("Source Sans Pro Bold"),local("SourceSansPro-Bold"),url(../assets/be4ba3dd17008135675e945b630be8f6.woff) format("woff")}html{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.6}@media (max-width:768px){html{font-size:18px}}*,:after,:before{box-sizing:inherit}body{margin:0;color:#584b4f;background-color:#fff}blockquote,fieldset,form,h1,h2,h3,h4,h5,h6,hr,ol,p,ul{margin:0 0 16px}ul ul{margin-bottom:0}hr{clear:both;height:0;border:0;border-bottom:1px dashed #eae8e3;padding:0}h1,h2,h3,h4,h5,h6{line-height:1;-webkit-font-smoothing:antialiased;color:#584b4f;font-family:Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-weight:700}h1{font-size:40px;font-size:2.5rem;margin-bottom:32px;color:#4f5b93;letter-spacing:-1px}h1:not(:first-child){margin-top:32px}h2{font-size:32px;font-size:2rem;margin-bottom:32px;color:#4f5b93}h2:not(:first-child){margin-top:32px}h3{font-size:24px;font-size:1.5rem;margin-bottom:24px}h3:not(:first-child){margin-top:24px}h4{font-size:20px;font-size:1.25rem;color:#4f5b93}h4:not(:first-child){margin-top:24px}@media (max-width:768px){h1{font-size:2rem}h2{font-size:1.75rem;margin-bottom:32px}}.container{padding:32px}@media (max-width:768px){.container{padding:16px}}.wrapper{max-width:1600px;margin:auto}.wrapper--medium{max-width:1280px}.wrapper--small{max-width:960px;margin:auto}.wrapper--narrow{max-width:640px}.main{width:calc(98% - 400px)}.main,.sidebar{margin-bottom:32px}.sidebar{width:calc(400px - 2%)}@media (max-width:1024px){.main,.sidebar{width:auto;margin-top:16px}}.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}.grid{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:102%;margin-left:-2%}.grid>*{margin-left:2%;max-width:100%}.grid--4cols>*{-ms-flex-preferred-size:23%;flex-basis:23%}.grid--3cols>*{-ms-flex-preferred-size:31.33%;flex-basis:31.33%}.grid--2cols>*{-ms-flex-preferred-size:48%;flex-basis:48%}@media (max-width:768px){.grid{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.grid,.grid>*{width:100%;margin-left:0}.grid>*{-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}}.header{width:100%;background:#fefefe;box-shadow:0 1px 0 0 rgba(0,0,0,.08);padding:0 32px}@media (max-width:768px){.header{padding:0 16px}}.header__container{width:100%;position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__logo{display:block;line-height:1;padding:16px 0}.header__logo svg{display:block;width:120px;height:18px}.header__search{margin:0;position:absolute;right:48px;top:7px;z-index:799}.header__search input{width:400px}@media (max-width:768px){.header__search input{width:calc(100vw - 94px)}}.header__menu{position:absolute;right:-12px;top:0;z-index:800}.hamburger{visibility:hidden}.searchbox{width:100%}.searchbox,.searchbox:focus{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:6px 8px 6px 32px;font-size:14px;font-size:.875rem;line-height:24px;color:#584b4f;border:0}.searchbox--collapsed:not(:focus){background-color:transparent;border:0;width:32px!important;margin-right:-12px}.welcome__intro{padding:16px 0 136px;border-bottom:1px dashed #eae8e3;background-image:radial-gradient(ellipse at center,#fff 0,#eae8e3 100%);background-size:auto 100%;background-position:50% 0}.welcome__intro h1{font-size:32px;font-size:2rem;margin-bottom:16px;color:#4f5b93}.welcome__logo{display:block;margin:0 auto;max-width:320px}.welcome__logo svg{display:block;height:240px}.welcome__content{padding-top:16px;display:block;max-width:calc(98% - 320px)}.welcome__example{display:block;margin:auto;max-width:800px;margin-top:-160px}.welcome__example .highlight pre{padding:32px;background:#fff;box-shadow:0 0 16px #d6d1c8}.welcome__intro .links a{color:#584b4f;text-decoration:none}.welcome__intro .links a:hover{color:#4f5b93;text-decoration:none}@media (max-width:768px){.welcome__content{padding:32px 16px 16px;max-width:100%}.welcome__logo svg{height:160px}.welcome__intro h1{text-align:center;font-size:1.75rem;margin-bottom:16px;color:#4f5b93}.welcome__intro .links{text-align:center}}code,pre,tt{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace}code,tt{font-size:12px;font-size:.75rem}pre{font-size:14px;font-size:.875rem;line-height:1.45}@media (max-width:768px){pre{font-size:.75rem}}.links{margin:0;padding:0}.links li{display:inline-block;margin:0 8px;text-decoration:none}.links li:first-child{margin-left:0}.links li:last-child{margin-right:0}.links a{display:block}.links a,.links a:hover{text-decoration:none}.off-canvas-menu{position:fixed;top:0;right:0;-webkit-transform:translate3d(105%,0,0);transform:translate3d(105%,0,0)}.component-info__contributors,.component-info__title{display:-webkit-box;display:-ms-flexbox;display:flex}.component-info__contributors{-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0;list-style:none}.component-info__contributors img{display:block;width:40px;height:auto}.version-selector__panel{position:fixed;top:-20000em;visibility:hidden}</style>
        <link rel="preload" href="../assets/main.2c3050a7d983f67a1210.css" as="style" onload="this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="../assets/main.2c3050a7d983f67a1210.css"></noscript>

        <script>!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){n.p=window.__assets},,,,,function(e,t,n){n(0),e.exports=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);Object(r.a)(),n(8),n(10),n(11),n(13),n(15)},function(e,t,n){"use strict";function r(e){try{return(e||window).document.createElement("link").relList.supports("preload")}catch(e){return!1}}function o(e){function t(){for(var e=r.querySelectorAll('link[rel="preload"][as="style"]'),t=0,n=e.length;t<n;t++)!function(t,n){var o=e[t];o.rel="";var i=r.createElement("link");i.rel="stylesheet",i.href=o.href,i.media="only x";var u=function(){i.media=o.getAttribute("media")||"all",i.removeEventListener("load",u)};i.addEventListener("load",u),o.parentNode.insertBefore(i,o.nextSibling||o)}(t)}var n=e||window,r=n.document;if(t(),"complete"!==r.readyState){var o=n.setInterval(t,300);n.addEventListener("load",function(){t(),n.clearInterval(o)})}}function i(e){r(e)||o(e)}t.a=i},function(e,t){},,function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12);n.n(r)},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14);n.n(r)},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);n.n(r)},function(e,t){}]);</script>
                </head>

    <body>
            <header class="header">
            <div class="wrapper">
                <div class="header__container">
                    <a class="header__logo" href="../">
                        <svg xmlns="http://www.w3.org/2000/svg" width="320" height="47.29" viewBox="0 428.964 320 47.29"><path fill="#584B4F" d="M30.86 452.385c1.637-2.287 2.455-5 2.455-8.134 0-4.313-1.367-7.87-4.088-10.68-2.723-2.812-6.39-4.216-11.004-4.216h-7.71c-3.79 0-6.49.798-8.1 2.388C.806 433.332 0 435.872 0 439.355v36.512h9.08v-17.245h6.53l9.08 17.245h10.52L24.82 457.12c2.395-.87 4.41-2.447 6.04-4.735zm-8.488-3.334c-1.24 1.33-2.82 1.99-4.734 1.99H9.08v-9.47c0-2.74 1.35-4.112 4.05-4.112h4.508c2 0 3.603.61 4.8 1.83 1.196 1.22 1.797 2.82 1.797 4.802 0 1.982-.623 3.64-1.864 4.964v-.003zm20.348 14.536c0 4.572 1.055 7.766 3.167 9.57 2.114 1.81 5.782 2.71 11.008 2.71h16.46v-8.1H57.548c-2.18 0-3.68-.35-4.51-1.045-.83-.695-1.24-1.96-1.24-3.788v-6.467h14.434l.656-8.1h-15.09v-10.912h21.56v-8.098H42.72v34.23zm57.97-33.442c-.718-.523-1.665-.787-2.84-.787-1.177 0-2.168.285-2.972.85-.807.567-1.537 1.592-2.19 3.073l-14.89 42.585h9.47l2.55-8.03h15.613l2.613 8.03h9.47l-14.893-42.588c-.567-1.572-1.21-2.613-1.93-3.135v.002zM92.1 460.19l5.75-18.42 5.487 18.418H92.1v.002zm53.074 5.455c-1.155 1.678-3.245 2.512-6.27 2.512-3.03 0-5.258-.914-6.697-2.74-1.394-1.83-2.093-5.25-2.093-10.256v-4.052c0-1.783.045-3.2.13-4.243.178-3.27.785-5.576 1.833-6.928 1.48-1.914 3.745-2.873 6.794-2.873 2.613 0 4.532.653 5.75 1.96 1.218 1.308 2.07 3.245 2.547 5.813h8.49c0-5.14-1.557-9.07-4.67-11.79-3.114-2.723-7.153-4.084-12.116-4.084-3.398 0-6.293.564-8.687 1.7-6.097 2.783-9.146 9.686-9.146 20.704v3.918c0 13.982 5.945 20.968 17.833 20.968 5.4 0 9.58-1.59 12.54-4.77 2.964-3.176 4.44-7.73 4.44-13.653h-8.426c-.346 3.53-1.1 6.134-2.25 7.81v.005zm14.667-36.29v8.1h12.412v38.41h9.08v-38.41h12.47v-8.1"/><path fill="#4F5B93" d="M218.89 429.356h-18.03v46.51h9.086v-14.897h8.944c4.876 0 8.647-1.337 11.328-4.016 2.683-2.68 4.02-6.608 4.02-11.788s-1.337-9.112-4.02-11.788c-2.68-2.68-6.454-4.02-11.328-4.02v-.002zm4.538 21.686c-1.15 1.177-2.815 1.768-5 1.768h-8.485v-15.354h8.484c4.483 0 6.73 2.572 6.73 7.71 0 2.744-.578 4.703-1.73 5.88v-.004zm43.93-2.02H250.31v-19.666h-9.088v46.51h9.086v-18.81h17.05v18.81h9.076v-46.51h-9.078m48.63 4.02c-2.683-2.68-6.46-4.02-11.335-4.02h-18.027v46.507h9.085V460.97h8.943c4.877 0 8.654-1.336 11.337-4.014 2.68-2.678 4.013-6.608 4.013-11.788s-1.332-9.112-4.013-11.79v-.003zm-6.795 17.666c-1.154 1.177-2.822 1.768-5 1.768h-8.484v-15.354h8.485c4.483 0 6.734 2.572 6.734 7.71 0 2.744-.583 4.703-1.735 5.88v-.004z"/></svg>
                    </a>
                    <form class="header__search">
                        <input type="search" class="searchbox searchbox--collapsed" data-docsearch placeholder="Search documentation...">
                    </form>
                    <div class="header__menu">
    <button class="hamburger" aria-expanded="false" aria-controls="off-canvas-menu" data-off-canvas-menu-toggle>
        <div class="hamburger__box">
            <div class="hamburger__inner">
                <span class="visually-hidden">Menu</span>
            </div>
        </div>
    </button>
</div>
<nav id="off-canvas-menu" class="off-canvas-menu" aria-hidden="true">
    <div class="off-canvas-menu__content">
        <button aria-label="Close menu" class="off-canvas-menu__close" aria-expanded="false" aria-controls="off-canvas-menu" data-off-canvas-menu-toggle>
            <i class="icon-x" aria-hidden="true"></i>
        </button>

        <section class="off-canvas-menu__section">
            <a class="off-canvas-menu__section-top" href="../">Home</a>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Core Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../event-loop/">
                        EventLoop

                        <span class="off-canvas-menu__version">
                            v0.4.3
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../stream/">
                        Stream

                        <span class="off-canvas-menu__version">
                            v0.7.6
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../promise/">
                        Promise

                        <span class="off-canvas-menu__version">
                            v2.5.1
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Network Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../socket/">
                        Socket

                        <span class="off-canvas-menu__version">
                            v0.8.9
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../datagram/">
                        Datagram

                        <span class="off-canvas-menu__version">
                            v1.3.0
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Protocol Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../http/">
                        HTTP

                        <span class="off-canvas-menu__version">
                            v0.8.1
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../http-client/">
                        HTTPClient

                        <span class="off-canvas-menu__version">
                            v0.5.6
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../dns/">
                        DNS

                        <span class="off-canvas-menu__version">
                            v0.4.12
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Utility Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../cache/">
                        Cache

                        <span class="off-canvas-menu__version">
                            v0.4.2
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../child-process/">
                        ChildProcess

                        <span class="off-canvas-menu__version">
                            v0.5.2
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../promise-timer/">
                        PromiseTimer

                        <span class="off-canvas-menu__version">
                            v1.2.1
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../promise-stream/">
                        PromiseStream

                        <span class="off-canvas-menu__version">
                            v1.1.1
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
        </div>
</nav>                </div>
            </div>
        </header>
    
        <div class="container">
        <div class="wrapper">
            <div class="grid grid--wrap grid--gutter">
                <main class="main">
                    <h1>
<a id="promisestream" class="anchor" href="#promisestream" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PromiseStream</h1>
<p><a href="https://travis-ci.org/reactphp/promise-stream" rel="nofollow"><img src="https://camo.githubusercontent.com/dcf080a0d77a420f513acef3463e91c3c4c2104e/68747470733a2f2f7472617669732d63692e6f72672f72656163747068702f70726f6d6973652d73747265616d2e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/reactphp/promise-stream.svg?branch=master" style="max-width:100%;"></a></p>
<p>The missing link between Promise-land and Stream-land
for <a href="https://reactphp.org/" rel="nofollow">ReactPHP</a>.</p>
<p><strong>Table of Contents</strong></p>
<ul>
<li>
<a href="#usage">Usage</a>
<ul>
<li><a href="#buffer">buffer()</a></li>
<li><a href="#first">first()</a></li>
<li><a href="#all">all()</a></li>
<li><a href="#unwrapreadable">unwrapReadable()</a></li>
<li><a href="#unwrapwritable">unwrapWritable()</a></li>
</ul>
</li>
<li><a href="#install">Install</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>
<p>This lightweight library consists only of a few simple functions.
All functions reside under the <code>React\Promise\Stream</code> namespace.</p>
<p>The below examples assume you use an import statement similar to this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">React\Promise\Stream</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Stream\</span>buffer(…);</span></pre></div>
<p>Alternatively, you can also refer to them with their fully-qualified name:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">\React\Promise\Stream\</span>buffer(…);</span></pre></div>
<h3>
<a id="buffer" class="anchor" href="#buffer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>buffer()</h3>
<p>The <code>buffer(ReadableStreamInterface $stream, int $maxLength = null)</code> function can be used to create
a <code>Promise</code> which resolves with the stream data buffer. With an optional maximum length argument
which defaults to no limit. In case the maximum length is reached before the end the promise will
be rejected with a <code>\OverflowException</code>.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> accessSomeJsonStream();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Stream\</span>buffer(<span class="pl-smi">$stream</span>)<span class="pl-k">-&gt;</span>then(<span class="pl-k">function</span> (<span class="pl-smi">$contents</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">var_dump</span>(<span class="pl-c1">json_decode</span>(<span class="pl-smi">$contents</span>));</span>
<span class="pl-s1">});</span></pre></div>
<p>The promise will resolve with all data chunks concatenated once the stream closes.</p>
<p>The promise will resolve with an empty string if the stream is already closed.</p>
<p>The promise will reject if the stream emits an error.</p>
<p>The promise will reject if it is canceled.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> accessSomeToLargeStream();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Stream\</span>buffer(<span class="pl-smi">$stream</span>, <span class="pl-c1">1024</span>)<span class="pl-k">-&gt;</span>then(<span class="pl-k">function</span> (<span class="pl-smi">$contents</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">var_dump</span>(<span class="pl-c1">json_decode</span>(<span class="pl-smi">$contents</span>));</span>
<span class="pl-s1">}, <span class="pl-k">function</span> (<span class="pl-smi">$error</span>) {</span>
<span class="pl-s1">    <span class="pl-c"><span class="pl-c">//</span> Reaching here when the stream buffer goes above the max size,</span></span>
<span class="pl-s1">    <span class="pl-c"><span class="pl-c">//</span> in this example that is 1024 bytes,</span></span>
<span class="pl-s1">    <span class="pl-c"><span class="pl-c">//</span> or when the stream emits an error. </span></span>
<span class="pl-s1">});</span></pre></div>
<h3>
<a id="first" class="anchor" href="#first" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>first()</h3>
<p>The <code>first(ReadableStreamInterface|WritableStreamInterface $stream, $event = 'data')</code>
function can be used to create a <code>Promise</code> which resolves once the given event triggers for the first time.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> accessSomeJsonStream();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Stream\</span>first(<span class="pl-smi">$stream</span>)<span class="pl-k">-&gt;</span>then(<span class="pl-k">function</span> (<span class="pl-smi">$chunk</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>The first chunk arrived: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$chunk</span>;</span>
<span class="pl-s1">});</span></pre></div>
<p>The promise will resolve with whatever the first event emitted or <code>null</code> if the
event does not pass any data.
If you do not pass a custom event name, then it will wait for the first "data"
event and resolve with a string containing the first data chunk.</p>
<p>The promise will reject if the stream emits an error – unless you're waiting for
the "error" event, in which case it will resolve.</p>
<p>The promise will reject once the stream closes – unless you're waiting for the
"close" event, in which case it will resolve.</p>
<p>The promise will reject if the stream is already closed.</p>
<p>The promise will reject if it is canceled.</p>
<h3>
<a id="all" class="anchor" href="#all" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>all()</h3>
<p>The <code>all(ReadableStreamInterface|WritableStreamInterface $stream, $event = 'data')</code>
function can be used to create a <code>Promise</code> which resolves with an array of all the event data.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> accessSomeJsonStream();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">Stream\</span>all(<span class="pl-smi">$stream</span>)<span class="pl-k">-&gt;</span>then(<span class="pl-k">function</span> (<span class="pl-smi">$chunks</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>The stream consists of <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-c1">count</span>(<span class="pl-smi">$chunks</span>) <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span> chunk(s)<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">});</span></pre></div>
<p>The promise will resolve with an array of whatever all events emitted or <code>null</code> if the
events do not pass any data.
If you do not pass a custom event name, then it will wait for all the "data"
events and resolve with an array containing all the data chunks.</p>
<p>The promise will resolve with an array once the stream closes.</p>
<p>The promise will resolve with an empty array if the stream is already closed.</p>
<p>The promise will reject if the stream emits an error.</p>
<p>The promise will reject if it is canceled.</p>
<h3>
<a id="unwrapreadable" class="anchor" href="#unwrapreadable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>unwrapReadable()</h3>
<p>The <code>unwrapReadable(PromiseInterface $promise)</code> function can be used to unwrap
a <code>Promise</code> which resolves with a <code>ReadableStreamInterface</code>.</p>
<p>This function returns a readable stream instance (implementing <code>ReadableStreamInterface</code>)
right away which acts as a proxy for the future promise resolution.
Once the given Promise resolves with a <code>ReadableStreamInterface</code>, its data will
be piped to the output stream.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span>$promise = someFunctionWhichResolvesWithAStream();</span></span>
<span class="pl-s1"><span class="pl-smi">$promise</span> <span class="pl-k">=</span> startDownloadStream(<span class="pl-smi">$uri</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-c1">Stream\</span>unwrapReadable(<span class="pl-smi">$promise</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$data</span>) {</span>
<span class="pl-s1">   <span class="pl-c1">echo</span> <span class="pl-smi">$data</span>;</span>
<span class="pl-s1">});</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>end<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">   <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>DONE<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">});</span></pre></div>
<p>If the given promise is either rejected or fulfilled with anything but an
instance of <code>ReadableStreamInterface</code>, then the output stream will emit
an <code>error</code> event and close:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$promise</span> <span class="pl-k">=</span> startDownloadStream(<span class="pl-smi">$invalidUri</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-c1">Stream\</span>unwrapReadable(<span class="pl-smi">$promise</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$error</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Error: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$error</span><span class="pl-k">-&gt;</span>getMessage();</span>
<span class="pl-s1">});</span></pre></div>
<p>The given <code>$promise</code> SHOULD be pending, i.e. it SHOULD NOT be fulfilled or rejected
at the time of invoking this function.
If the given promise is already settled and does not resolve with an
instance of <code>ReadableStreamInterface</code>, then you will not be able to receive
the <code>error</code> event.</p>
<p>You can <code>close()</code> the resulting stream at any time, which will either try to
<code>cancel()</code> the pending promise or try to <code>close()</code> the underlying stream.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$promise</span> <span class="pl-k">=</span> startDownloadStream(<span class="pl-smi">$uri</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-c1">Stream\</span>unwrapReadable(<span class="pl-smi">$promise</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addTimer(<span class="pl-c1">2.0</span>, <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>close();</span>
<span class="pl-s1">});</span></pre></div>
<h3>
<a id="unwrapwritable" class="anchor" href="#unwrapwritable" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>unwrapWritable()</h3>
<p>The <code>unwrapWritable(PromiseInterface $promise)</code> function can be used to unwrap
a <code>Promise</code> which resolves with a <code>WritableStreamInterface</code>.</p>
<p>This function returns a writable stream instance (implementing <code>WritableStreamInterface</code>)
right away which acts as a proxy for the future promise resolution.
Once the given Promise resolves with a <code>WritableStreamInterface</code>, any data you
wrote to the proxy will be piped to the inner stream.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span>$promise = someFunctionWhichResolvesWithAStream();</span></span>
<span class="pl-s1"><span class="pl-smi">$promise</span> <span class="pl-k">=</span> startUploadStream(<span class="pl-smi">$uri</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-c1">Stream\</span>unwrapWritable(<span class="pl-smi">$promise</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>write(<span class="pl-s"><span class="pl-pds">'</span>hello<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>end(<span class="pl-s"><span class="pl-pds">'</span>world<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>close<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {</span>
<span class="pl-s1">   <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>DONE<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">});</span></pre></div>
<p>If the given promise is either rejected or fulfilled with anything but an
instance of <code>WritableStreamInterface</code>, then the output stream will emit
an <code>error</code> event and close:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$promise</span> <span class="pl-k">=</span> startUploadStream(<span class="pl-smi">$invalidUri</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-c1">Stream\</span>unwrapWritable(<span class="pl-smi">$promise</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$error</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Error: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$error</span><span class="pl-k">-&gt;</span>getMessage();</span>
<span class="pl-s1">});</span></pre></div>
<p>The given <code>$promise</code> SHOULD be pending, i.e. it SHOULD NOT be fulfilled or rejected
at the time of invoking this function.
If the given promise is already settled and does not resolve with an
instance of <code>WritableStreamInterface</code>, then you will not be able to receive
the <code>error</code> event.</p>
<p>You can <code>close()</code> the resulting stream at any time, which will either try to
<code>cancel()</code> the pending promise or try to <code>close()</code> the underlying stream.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$promise</span> <span class="pl-k">=</span> startUploadStream(<span class="pl-smi">$uri</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-c1">Stream\</span>unwrapWritable(<span class="pl-smi">$promise</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addTimer(<span class="pl-c1">2.0</span>, <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>close();</span>
<span class="pl-s1">});</span></pre></div>
<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h2>
<p>The recommended way to install this library is <a href="https://getcomposer.org" rel="nofollow">through Composer</a>.
<a href="https://getcomposer.org/doc/00-intro.md" rel="nofollow">New to Composer?</a></p>
<p>This project follows <a href="http://semver.org/" rel="nofollow">SemVer</a>.
This will install the latest supported version:</p>
<div class="highlight highlight-source-shell"><pre>$ composer require react/promise-stream:^1.1.1</pre></div>
<p>See also the <a href="changelog.html">CHANGELOG</a> for details about version upgrades.</p>
<p>This project aims to run on any platform and thus does not require any PHP
extensions and supports running on legacy PHP 5.3 through current PHP 7+ and
HHVM.
It's <em>highly recommended to use PHP 7+</em> for this project.</p>
<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>
<p>MIT, see <a href="license.html">LICENSE file</a>.</p>
                </main>
                <aside class="sidebar" role="complementary">
                    <section class="component-info">
                        <h2 class="component-info__title">
                            <a href="../promise-stream/">PromiseStream</a>

                            <div class="version-selector">
                                <button class="version-selector__button version-selector__button--latest" aria-expanded="false" aria-controls="component-version-selector" data-version-selector-toggle>
                                    v1.1.1

                                    <i class="icon-chevron-down" aria-hidden="true"></i>
                                    <i class="icon-chevron-up" aria-hidden="true"></i>
                                </button>

                                <div id="component-version-selector" class="version-selector__panel" aria-hidden="true">
                                    <p>Read the documentation of development and older versions on GitHub:</p>

                                    <ul class="version-selector__list">
                                        <li>
                                            <a href="https://github.com/reactphp/promise-stream#readme" class="version-selector__version version-selector__version--dev">
                                                master
                                            </a>
                                        </li>
                                                                                                                                                                                                                    <li>
                                                <a href="https://github.com/reactphp/promise-stream/tree/v1.1.0#readme" class="version-selector__version">
                                                    v1.1.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/promise-stream/tree/v1.0.0#readme" class="version-selector__version">
                                                    v1.0.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/promise-stream/tree/v0.1.2#readme" class="version-selector__version">
                                                    v0.1.2
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/promise-stream/tree/v0.1.1#readme" class="version-selector__version">
                                                    v0.1.1
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/promise-stream/tree/v0.1.0#readme" class="version-selector__version">
                                                    v0.1.0
                                                </a>
                                            </li>
                                                                                                                        </ul>
                                </div>
                            </div>
                        </h2>

                        <ul class="component-info__info">
                            <li>
                                <a href="https://github.com/reactphp/promise-stream">
                                    <i class="icon-github" aria-hidden="true"></i> Repository
                                </a>
                            </li>
                            <li>
                                <a href="../promise-stream/changelog.html">
                                    <i class="icon-calendar" aria-hidden="true"></i> Changelog
                                </a>
                            </li>
                            <li>
                                <a href="../promise-stream/license.html">
                                    <i class="icon-law" aria-hidden="true"></i> MIT License
                                </a>
                            </li>
                        </ul>

                        <h3 class="component-info__subtitle">Installation</h3>

                        <div class="highlight highlight-source-shell"><pre>composer require react/promise-stream:^1.1.1</pre></div>

                        <h3 class="component-info__subtitle">Contributors</h3>

                        <ul class="component-info__contributors">
                                                    <li>
                                <a href="https://github.com/clue">
                                    <img src="https://avatars1.githubusercontent.com/u/776829?v=4&amp;s=40" srcset="https://avatars1.githubusercontent.com/u/776829?v=4&amp;s=80 2x" alt="clue" title="clue (31 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/WyriHaximus">
                                    <img src="https://avatars2.githubusercontent.com/u/147145?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/147145?v=4&amp;s=80 2x" alt="WyriHaximus" title="WyriHaximus (18 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/jsor">
                                    <img src="https://avatars2.githubusercontent.com/u/55574?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/55574?v=4&amp;s=80 2x" alt="jsor" title="jsor (5 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/carusogabriel">
                                    <img src="https://avatars3.githubusercontent.com/u/16328050?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/16328050?v=4&amp;s=80 2x" alt="carusogabriel" title="carusogabriel (1 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/kelunik">
                                    <img src="https://avatars0.githubusercontent.com/u/2743004?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/2743004?v=4&amp;s=80 2x" alt="kelunik" title="kelunik (1 contribution)">
                                </a>
                            </li>
                                                </ul>

                        <h3 class="component-info__subtitle">Activity</h3>

                        <div class="component-info__participation">
                            <svg width="320" height="42">
    <defs>
        <linearGradient id="reactphp-promise-stream-participation-gradient" x1="0" x2="0" y1="1" y2="0">
            <stop offset="10%" stop-color="#40a977"></stop>
            <stop offset="90%" stop-color="#ba3525"></stop>
        </linearGradient>
        <mask id="reactphp-promise-stream-participation-sparkline" x="0" y="0" width="320" height="40" >
            <polyline 
                transform="translate(0, 40) scale(1,-1)"
                points="0,1 6,1 12,1 18,1 24,1 30,1 36,1 42,1 48,1 54,1 60,1 66,1 72,1 78,4 84,1 90,1 96,8 102,1 108,1 114,1 120,1 126,1 132,1 138,1 144,1 150,1 156,1 162,1 168,1 174,1 180,1 186,1 192,1 198,1 204,1 210,1 216,1 222,2 228,6 234,4 240,2 246,2 252,1 258,1 264,5 270,3 276,1 282,1 288,9 294,1 300,1 306,1" 
                fill="transparent" 
                stroke="#40a977" 
                stroke-width="2"
            >
        </mask>
    </defs>

    <g transform="translate(0, -1.5)">
        <rect 
            x="0" 
            y="-2" 
            width="320" 
            height="42"
            style="stroke:none;fill:url(#reactphp-promise-stream-participation-gradient);mask:url(#reactphp-promise-stream-participation-sparkline)"
        ></rect>
    </g>
</svg>
                        </div>
                    </section>
                </aside>
            </div>
        </div>
    </div>

            <footer class="footer">
            <div class="wrapper">
                <ul class="links">
                    <li><a href="https://github.com/reactphp"><i class="icon-github" aria-hidden="true"></i> GitHub</a></li>
                    <li><a href="https://twitter.com/reactphp"><i class="icon-twitter" aria-hidden="true"></i> Twitter</a></li>
                    <li><a href="irc://irc.freenode.net/reactphp"><i class="icon-hash" aria-hidden="true"></i> IRC</a></li>
                </ul>
            </div>
        </footer>
    
    <script async src="../assets/main.2c3050a7d983f67a1210.js"></script>
    </body>
</html>
